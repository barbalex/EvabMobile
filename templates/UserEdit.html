<!DOCTYPE html>
<html>
  <head>
  	<link rel="SHORTCUT ICON" href="../../Bilder/favicon.ico">
  	<meta http-equiv=Content-Type content="text/html; charset=UTF-8"/>
  	<meta name="viewport" content="width=device-width, initial-scale=1"/>
  	<title>EvAB</title>
  	<link rel="stylesheet" href="../../style/jquery.mobile.css" type="text/css"/>
  	<link rel="stylesheet" href="../../style/evab.css" type="text/css"/>
  	<link rel="stylesheet" href="../../style/jquery.mobile.simpledialog.css" type="text/css"/>
  	<style type="text/css">.ui-icon-evab-location {background-image:url('../../Bilder/evab-location.png');}</style>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.js"></script>
	<script type="text/javascript">			
		$(document).bind("mobileinit", function() {
			$.mobile.loadingMessage = 'chrampfe!'; 
			$.mobile.defaultPageTransition  = 'none';
		});
    </script>	
	<script type="text/javascript" src="../../vendor/couchapp/jquery.couch.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.couch.app.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.couch.app.util.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.mustache.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.mobile.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/phonegap.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/evab.js"></script>
	<script type="text/javascript" src="../../vendor/couchapp/jquery.mobile.simpledialog.js"></script>
  </head>
  <body>
  	<div data-role="page">
  		<div data-role="header" data-position="fixed">
  			<a href="../../BeobListe.html" data-rel="back" data-role="button" data-icon="arrow-l" rel="external" data-iconpos="notext">zur Beobachtungs-Liste</a>
  			<h2>meine Einstellungen</h2>
  		</div>
		<div id="UserEditContent" data-role="content" data-theme="c" style="padding:0em;">
			<form id="UserEditForm" action="#" method="get" data-identity="{{document}}"
				<div data-role="fieldcontain">
					<label for="Benutzername">Benutzername:</label>
					<input id="Benutzername" name="Benutzername" type="text" value="{{UserName}}"/>
					<p>Der Benutzername kann nicht verändert werden.<br />
					EvAB mobile speichert nur die verschlüsselte Form Ihres Passworts. Es kann deshalb nicht verändert werden und wird nicht angezeigt.</p>
				</div>
				<hr />
				<div data-role="fieldcontain">
					<label for="Autor">Autor:</label>
					<input id="Autor" name="Autor" type="text" value="{{Autor}}" placeholder="(erforderlich)" required/>
					<p>Eingabe obligatorisch. Beschreiben Sie den Autor so, wie er in den Beobachtungen erscheinen soll. Beispiel: Fritz Muster, Zürich.</p>
				</div>
				<hr />
				<div data-role="fieldcontain">
					<label for="Email">email-Adresse:</label>
					<input id="Email" name="Email" type="email" value="{{Email}}" placeholder="(fakultativ)"/>
				</div>
				<hr />
				<div data-role="fieldcontain">
				    <fieldset data-role="controlgroup">
				    	<legend>Ich will in diesem Modus erfassen:</legend>
				         	<input type="radio" name="Modus" id="einfach" value="einfach" />
				         	<label for="einfach">einfach</label>
				         	<input type="radio" name="Modus" id="hierarchisch" value="hierarchisch"/>
				         	<label for="hierarchisch">hierarchisch</label>
				    </fieldset>
				</div>
				<p>Im einfachen Modus erfassen Sie für alle Artengruppen dieselben Informationen in einer übersichtlichen Liste.<br />Vorteile: 1. einfach 2. übersichtlich 3. geeignet für die Erfassung von Einzel- oder Gelegenheitsbeobachtungen.<br /><br />Der hierarchische Modus ist für Experten und "Poweruser" gedacht: Hier stehen in den fünf Hierarchiestufen <i>Projekt, Raum, Ort, Zeit</i> und <i>Art</i> viele Felder zur Verfügung.<br />Vorteile: 1. Es können Artgruppen-spezifische Informationen erfasst werden. 2. Effizienter, wenn am selben Ort viele Beobachtungen erfasst werden (z.B. für Vegetationsaufnahmen).</p>
				<hr />
				<div data-role="fieldcontain">
				    <fieldset data-role="controlgroup">
				    	<legend>Meine Beobachtungen dürfen verwendet werden:</legend>
				         	<input type="radio" name="Datenverwendung" id="JaAber" value="JaAber"  />
				         	<label for="JaAber">ja, für Naturschutzzwecke (Standard)*</label>
				         	<input type="radio" name="Datenverwendung" id="Ja" value="Ja"  />
				         	<label for="Ja">ja, ohne Einschränkung</label>
				         	<input type="radio" name="Datenverwendung" id="Nein" value="Nein" />
				         	<label for="Nein">nein</label>
				    </fieldset>
				</div>
				<p>* Bei dieser Option werden die <a href="http://www.crsf.ch/documents/download/d/Deontologie_2008_de.pdf" target="_blank">Datenschutzrichtlinien der Schweizerischen Nationalen Datenzentren für Fauna und Flora</a> eingehalten.<br />Die zuständigen Naturschutzstellen von Bund, Kanton und Gemeinden verwenden die Informationen nur für Naturschutzzwecke. Die Daten nicht besonders empfindlicher Arten können in grober räumlicher Auflösung publiziert werden.</p>
			</form>
		</div>
	</div>

  </body>
    <script type="text/javascript">
		$(document).ready(function() {

			$db = $.couch.db("evab");
			
			User = "";

			userCtx = null;
			$.couch.session({
				success : function(r) {
					var userCtx = r.userCtx;
					User = userCtx.name;
				}
			});
			
			/*
			$.ajax({
			    url: '/_session?callback=',
			    dataType: 'json',
			    async: false,
			    success: function(session){
			        User = session.userCtx.name;
			    }
			});
			*/
			
			//Feld Benutzername deaktivieren
			$('#Benutzername').textinput();
			$('#Benutzername').textinput('disable');

			//Modus managen
			var Modus = "{{Modus}}";
			$("input[name='Modus']").checkboxradio();
			$("#{{Modus}}").prop("checked",true).checkboxradio("refresh");
			$("input[name='Modus']").change(function(){
				Modus = $(this).prop("id");
				speichern(Modus);
			});

			//Datenverwendung managen
			Datenverwendung = "{{Datenverwendung}}";
			$("input[name='Datenverwendung']").checkboxradio();
			$("#{{Datenverwendung}}").prop("checked",true).checkboxradio("refresh");
			$("input[name='Datenverwendung']").change(function(){
				Datenverwendung = $(this).prop("id");
				speichern(Modus);
			});

			//jedes Feld bei Änderung speichern
			//Modus und Datenverwendung wurden oben gespeichert
			$("#Autor").change(function(){
				speichern(Modus);
			});
			$("#Email").change(function(){
				speichern(Modus);
			});
		});
	</script>
	<script type="text/javascript">

		function speichern(Modus) {
			if ($("input#Autor").val() == ""){
				melde("Bitte Autor eingeben");
				return;
			}
			var Userr = {};
			var docId = "{{id}}";
			Userr = $("#UserEditForm").serializeObject();
			Userr.Typ = "User";
			Userr.UserName = "{{UserName}}";
			Userr._id = docId;
			Userr.Modus = Modus;
			Userr.Datenverwendung = Datenverwendung;
			$db.openDoc(docId, {
				success: function(doc) {
					Userr._rev = doc._rev;
					$db.saveDoc(Userr, {
						error: function() {
							melde("Fehler: User nicht gespeichert");
						 }
					});
				}
			});
		}
		
	</script>
  
</html>
