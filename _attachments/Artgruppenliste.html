<!DOCTYPE html>
<html lang="de">
  <head>
  	<link rel="SHORTCUT ICON" href="Bilder/favicon.ico">
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<title>EvAB</title>
  	<link rel="stylesheet" href="style/jquery.mobile.css">
	<link rel="stylesheet" href="style/themes/gruen.min.css">
  	<link rel="stylesheet" href="style/jquery.mobile.datebox.css">
  	<link rel="stylesheet" href="style/evab.css">
	<script src="vendor/couchapp/jquery.js"></script>
	<script>
		$(document).on("mobileinit", function () {
			$.mobile.page.prototype.options.degradeInputs.date = 'text';
			$.mobile.page.prototype.options.degradeInputs.time = 'text';
			$.mobile.selectmenu.prototype.options.nativeMenu = false;
			$.event.special.swipe.horizontalDistanceThreshold = 250;
			$.mobile.buttonMarkup.hoverDelay = 0;
		});
	</script>
	<script src="vendor/couchapp/jquery.couch.js"></script>
	<script src="vendor/couchapp/jquery.form.js"></script>
	<script src="vendor/couchapp/jquery.mobile.js"></script>
	<script src="vendor/couchapp/jquery.mobile.datebox.js"></script>
	<script src="vendor/couchapp/evab.js"></script>
	<script src="vendor/couchapp/sha1.js"></script>
	<script src="https://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="vendor/couchapp/markerclusterer.js"></script>
  	<script src="vendor/couchapp/markerwithlabel.js"></script>
  </head>
  <body>
	<div data-role="page" data-dom-cache="true" id="agl_Page">
		<div data-role="header" data-position="fixed" data-tap-toggle="false" id="agl_Header">
			<a href="#" data-role="button" data-icon="arrow-l" data-iconpos="notext" data-rel="back">zurück</a>
			<h1>Artgruppe wählen</h1>
			<a href="#" id="agl_standardgruppe" data-role="button">nächste Gruppe merken</a>
		</div>
		<div data-role="content" style="padding-top:0px;">
			<ul id="agl_ArtgruppenListe" data-role="listview" data-filter="true" data-filter-placeholder="suchen...">
			</ul>
			<p id="agl_Hinweistext" class="HinweisDynamischerFeldaufbau">Die Liste wird aufgebaut...</p>
		</div>
		<script charset="utf-8">
			
			$("#agl_Page").on("pageshow", function () {
				erstelleArtgruppenListe();
				delete window.gruppe_merken;
			});

			$("#agl_Page").on("pagehide", function () {
				$("#agl_standardgruppe").html("nächste Gruppe merken");
				// ausgeschaltet, weil mit jqm 1.4 nicht kompatibel
				//$("#agl_standardgruppe").button('refresh');
			});

			$(":jqmData(role='page')").on("pageinit", function () {
				// Vorsicht: Genauer als body funktioniert hier nicht, weil die nested List im DOM
				// jedes mal eine eigene Page aufbaut
				$("body").on("click", "[name='ArtgruppenListItem']", function (event) {
					event.preventDefault();
					localStorage.aArtGruppe = $(this).attr("ArtGruppe");
					// wenn die Gruppe gemerkt werden soll, sie als globale Variable speichern
					if (window.gruppe_merken) {
						window.gruppe_merken = $(this).attr("ArtGruppe");
					}
					$.mobile.navigate("Artenliste.html");
				});

				$("#agl_Page").on("click", "#agl_standardgruppe", function() {
					if ($(this).html() === "nächste Gruppe merken") {
						window.gruppe_merken = true;
						$(this).html("nächste Gruppe wird gemerkt");
					} else {
						delete window.gruppe_merken;
						$(this).html("nächste Gruppe merken");
					}
					// ausgeschaltet, weil mit jqm 1.4 nicht kompatibel
					//$("#agl_standardgruppe").button('refresh');
				});
			});
		</script>
	</div>
  </body>
</html>